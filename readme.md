# Device End of Yabee Tech

For Chinese version please go to [切换到中文版](readme_cn.md)

[^_^]:
https://github.com/industry-ai/device

[^_^]:
https://gitee.com/industry-ai/device

[^_^]:
F:\mygit\device

************************************

This is a repository of supplying resource for the development of Stencil Frame
Automatic Locating System for Flat Printing Pipeline, supported by Yabee tech Co.

Maintaining by: Dr. Jicheng Hu

## 1 On-board Firmware

### 1.1 Executive actions

The most important aspect of on-board firmware is the receiving and parsing procedure
of the CAN frame, transported on the CAN network.
The on-board control actions are all formed in the form of executive functions and 
will be called using function pointers.

The main loop performs executive actions by checking the action chain, 
and some timestamp actions are put into the action chain by the clock. 
We set up a separate action chain for timestamp actions to prevent thread conflicts. 
The header and tailer of action chain are connected to form a ring.
Clock action can be generated by normal action or by interrupt.
Real-time and synchronized actions are performed directly during interrupts.

The current status of each device on the board is periodically sent whenever the control 
board is connected to the CAN network.

### 1.2 Action types

* Real-time action: Executed directly in an interrupt, a synchronous action is a real-time action
* Timeout action: The action resulting from time out of a clock interruption，
can be either real-time or normal
* Normal action: The action that is performed through the action chain of the main loop, 
which is executed in turn by the main loop

Actions are managed by index number, each on-board action has its own index, 
and is maintained by the control board in the control center, i.e. 
each control board has its own action index control table to be managed by the control center.

Action types:
```c
// action, with index number less than REALTIME_ACTION, is a realtime action
#define	REALTIME_ACTION		0x01
// action, with index number less than TIMEOUT_ACTION, is a timer action
#define	TIMEOUT_ACTION		0x02
// action, with index number less than NORMAL_ACTION, is a normal action
#define	NORMAL_ACTION		0x0F
```

Executive actions are saved in the form of function pointers in a list of function pointer arrays, 
which are marked with the function pointer array index, so that the function pointer corresponding to 
the array index can be obtained quickly.



